os: osx
osx_image: xcode9.4

cache:
  - cocoapods
  - directories:
    - $HOME/.pub-cache
    - ios/vendor/bundle

install:
  - git clone -b beta https://github.com/flutter/flutter.git
  - export PATH=`pwd`/flutter/bin:$PATH
  - brew install --HEAD libimobiledevice
  - brew install ideviceinstaller
  - brew install ios-deploy
  - flutter doctor -v
  - cd ios; bundle install --deployment

jobs:  
  include:
    - stage: "retrieving_signing"
      name: "Retrieving signing certificates and profiles"
      script:
        - [ ! -e ~/.ssh ] && mkdir -p ~/.ssh
        - echo "$SSH_CONFIG" | base64 --decode > ~/.ssh/config
        - echo "$GIT_PRIVATE_KEY" | base64 --decode > ~/.ssh/github
        - cd ios
        - bundle exec fastlane retrieving_signing
        - security find-identity -v -p codesigning

